<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>K-Vibe Shop</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body { font-family: 'Poppins', sans-serif; margin:0; padding:0; background:#f5f5f5; }
    header { background:#ff9aa2; color:#fff; text-align:center; padding:20px; font-size:24px; font-weight:700; }
    h2 { margin:20px; }
    .categories, .products, .cart-items, .orders-list { display:flex; flex-wrap:wrap; gap:20px; padding:20px; }
    .category, .product, .cart-item, .order { background:#fff; padding:15px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); text-align:center; width:150px; }
    .category i, .product i { font-size:48px; color:#ff9aa2; margin-bottom:10px; }
    .category img, .product img { width:80px; height:80px; object-fit:cover; margin-bottom:10px; border-radius:10px; }
    .cart-item img { width:50px; height:50px; object-fit:cover; border-radius:6px; margin-bottom:5px; }
    .add-section { background:#fff; padding:20px; margin:20px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    input, select, button, textarea { margin:5px 0; padding:10px; width:100%; border:1px solid #ddd; border-radius:8px; font-family:'Poppins',sans-serif; }
    button { background:#ff9aa2; color:#fff; font-weight:600; cursor:pointer; border:none; }
    button:hover { background:#ff7b85; }
    .cart-summary { padding:20px; font-size:18px; font-weight:600; }
    .cart-actions button { width:auto; margin:5px; padding:8px 12px; font-size:14px; }
    /* Модальное окно */
    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
    .modal-content { background:#fff; padding:20px; border-radius:12px; max-width:400px; width:90%; }
    .modal h3 { margin-top:0; }
    .modal button { margin-top:10px; }
  </style>
</head>
<body>
  <header>K-Vibe Shop</header>

  <h2>Категории</h2>
  <div id="categories" class="categories"></div>

  <div class="add-section">
    <h3>Добавить категорию</h3>
    <input type="text" id="new-cat-name" placeholder="Название категории">
    <input type="text" id="new-cat-icon" placeholder="Класс иконки (например: fa-solid fa-bag-shopping)">
    <p style="font-size:12px;color:#888;">Или загрузите картинку:</p>
    <input type="file" id="new-cat-img">
    <button onclick="addCategory()">Добавить категорию</button>
  </div>

  <h2>Товары</h2>
  <div id="products-list" class="products"></div>

  <div class="add-section">
    <h3>Добавить товар</h3>
    <input type="text" id="new-prod-name" placeholder="Название товара">
    <input type="number" id="new-prod-price" placeholder="Цена">
    <textarea id="new-prod-desc" placeholder="Описание"></textarea>
    <select id="new-prod-cat"></select>
    <input type="text" id="new-prod-icon" placeholder="Класс иконки (например: fa-solid fa-shirt)">
    <p style="font-size:12px;color:#888;">Или загрузите картинку:</p>
    <input type="file" id="new-prod-img">
    <button onclick="addProduct()">Добавить товар</button>
  </div>

  <h2>Корзина</h2>
  <div id="cart" class="cart-items"></div>
  <div class="cart-summary">
    Итого: <span id="cart-total">0</span> ₽
    <br><br>
    <button onclick="clearCart()">Очистить корзину</button>
    <button onclick="checkout()">Оформить заказ</button>
  </div>

  <h2>История заказов</h2>
  <div id="orders" class="orders-list"></div>

  <!-- Модальное окно -->
  <div id="checkout-modal" class="modal">
    <div class="modal-content">
      <h3>Ваш заказ</h3>
      <div id="order-details"></div>
      <input type="text" id="order-name" placeholder="Ваше имя">
      <input type="text" id="order-address" placeholder="Адрес доставки">
      <button onclick="confirmOrder()">Подтвердить заказ</button>
      <button onclick="closeModal()">Закрыть</button>
    </div>
  </div>

  <script>
    let categories = JSON.parse(localStorage.getItem('categories')||'[]');
    let products = JSON.parse(localStorage.getItem('products')||'[]');
    let cart = JSON.parse(localStorage.getItem('cart')||'[]');
    let orders = JSON.parse(localStorage.getItem('orders')||'[]');

    if(categories.length === 0){
      categories = [
        {name:"Сумки", icon:"fa-solid fa-bag-shopping", img:null},
        {name:"Штаны", icon:"fa-solid fa-user-tie", img:null},
        {name:"Футболки", icon:"fa-solid fa-shirt", img:null},
        {name:"Кепки", icon:"fa-solid fa-hat-cowboy", img:null}
      ];
    }

    function saveData(){
      localStorage.setItem('categories',JSON.stringify(categories));
      localStorage.setItem('products',JSON.stringify(products));
      localStorage.setItem('cart',JSON.stringify(cart));
      localStorage.setItem('orders',JSON.stringify(orders));
      renderCategories();
      renderProducts();
      populateCategories();
      renderCart();
      renderOrders();
    }

    function addCategory(){
      const name=document.getElementById('new-cat-name').value;
      const icon=document.getElementById('new-cat-icon').value;
      const file=document.getElementById('new-cat-img').files[0];
      if(!name) return alert("Введите название категории!");
      if(icon){
        categories.push({name, icon, img:null});
        saveData();
      } else if(file){
        const reader=new FileReader();
        reader.onload=e=>{
          categories.push({name, icon:null, img:e.target.result});
          saveData();
        };
        reader.readAsDataURL(file);
      } else {
        alert("Добавьте иконку или картинку!");
      }
      document.getElementById('new-cat-name').value='';
      document.getElementById('new-cat-icon').value='';
      document.getElementById('new-cat-img').value='';
    }

    function addProduct(){
      const name=document.getElementById('new-prod-name').value;
      const price=document.getElementById('new-prod-price').value;
      const desc=document.getElementById('new-prod-desc').value;
      const cat=document.getElementById('new-prod-cat').value;
      const icon=document.getElementById('new-prod-icon').value;
      const file=document.getElementById('new-prod-img').files[0];
      if(!name || !price || !cat) return alert("Заполните все обязательные поля!");
      if(icon){
        products.push({name, price, desc, category:cat, icon, img:null});
        saveData();
      } else if(file){
        const reader=new FileReader();
        reader.onload=e=>{
          products.push({name, price, desc, category:cat, icon:null, img:e.target.result});
          saveData();
        };
        reader.readAsDataURL(file);
      } else {
        alert("Добавьте иконку или картинку для товара!");
      }
      document.getElementById('new-prod-name').value='';
      document.getElementById('new-prod-price').value='';
      document.getElementById('new-prod-desc').value='';
      document.getElementById('new-prod-cat').value='';
      document.getElementById('new-prod-icon').value='';
      document.getElementById('new-prod-img').value='';
    }

    function renderCategories(){
      const container=document.getElementById('categories');
      container.innerHTML='';
      categories.forEach(cat=>{
        const div=document.createElement('div');
        div.className='category';
        if(cat.icon){
          const i=document.createElement('i');
          i.className=cat.icon;
          div.appendChild(i);
        } else if(cat.img){
          const img=document.createElement('img');
          img.src=cat.img;
          div.appendChild(img);
        }
        const name=document.createElement('h3');
        name.innerText=cat.name;
        div.appendChild(name);
        container.appendChild(div);
      });
    }

    function renderProducts(){
      const container=document.getElementById('products-list');
      container.innerHTML='';
      products.forEach((p,idx)=>{
        const div=document.createElement('div');
        div.className='product';
        if(p.icon){
          const i=document.createElement('i');
          i.className=p.icon;
          div.appendChild(i);
        } else if(p.img){
          const img=document.createElement('img');
          img.src=p.img;
          div.appendChild(img);
        }
        const name=document.createElement('h3');
        name.innerText=p.name;
        div.appendChild(name);
        const price=document.createElement('p');
        price.innerText=p.price+" ₽";
        div.appendChild(price);
        const desc=document.createElement('p');
        desc.innerText=p.desc;
        div.appendChild(desc);
        const btn=document.createElement('button');
        btn.innerText="Добавить в корзину";
        btn.onclick=()=>addToCart(idx);
        div.appendChild(btn);
        container.appendChild(div);
      });
    }

    function addToCart(index){
      const product=products[index];
      const existing=cart.find(item=>item.name===product.name);
      if(existing){
        existing.qty+=1;
      } else {
        cart.push({...product, qty:1});
      }
      saveData();
    }

    function renderCart(){
      const container=document.getElementById('cart');
      container.innerHTML='';
      let total=0;
      cart.forEach((item,idx)=>{
        const div=document.createElement('div');
        div.className='cart-item';
        if(item.icon){
          const i=document.createElement('i');
          i.className=item.icon;
          div.appendChild(i);
        } else if(item.img){
          const img=document.createElement('img');
          img.src=item.img;
          div.appendChild(img);
        }
        const name=document.createElement('h4');
        name.innerText=item.name;
        div.appendChild(name);
        const qty=document.createElement('p');
        qty.innerText="Количество: "+item.qty;
        div.appendChild(qty);
        const price=document.createElement('p');
        price.innerText="Цена: "+item.price+" ₽";
        div.appendChild(price);
        const actions=document.createElement('div');
        actions.className="cart-actions";
        const plus=document.createElement('button');
        plus.innerText="+";
        plus.onclick=()=>{item.qty++;saveData();};
        const minus=document.createElement('button');
        minus.innerText="-";
        minus.onclick=()=>{if(item.qty>1){item.qty--;}else{cart.splice(idx,1);}saveData();};
        actions.appendChild(plus);
        actions.appendChild(minus);
        div.appendChild(actions);
        container.appendChild(div);
        total+=item.price*item.qty;
      });
      document.getElementById('cart-total').innerText=total;
    }

    function renderOrders(){
      const container=document.getElementById('orders');
      container.innerHTML='';
      if(orders.length===0){
        container.innerHTML="<p style='margin:20px;'>Заказов пока нет</p>";
        return;
      }
      orders.forEach(order=>{
        const div=document.createElement('div');
        div.className='order';
        div.innerHTML=`
          <h4>Заказ от ${order.date}</h4>
          <p><b>Имя:</b> ${order.name}</p>
          <p><b>Адрес:</b> ${order.address}</p>
          <p><b>Сумма:</b> ${order.total} ₽</p>
          <div style="font-size:14px; text-align:left;">${order.items.map(i=>`${i.name} × ${i.qty}`).join("<br>")}</div>
        `;
        container.appendChild(div);
      });
    }

    function populateCategories(){
      const select=document.getElementById('new-prod-cat');
      select.innerHTML='';
      categories.forEach(cat=>{
        const opt=document.createElement('option');
        opt.value=cat.name;
        opt.innerText=cat.name;
        select.appendChild(opt);
      });
    }

    function clearCart(){
      cart=[];
      saveData();
    }

    function checkout(){
      if(cart.length===0) return alert("Корзина пуста!");
      document.getElementById('order-details').innerHTML=
        cart.map(i=>`${i.name} × ${i.qty} = ${i.price*i.qty} ₽`).join("<br>")+
        `<br><br><b>Итого: ${document.getElementById('cart-total').innerText} ₽</b>`;
      document.getElementById('checkout-modal').style.display="flex";
    }

    function closeModal(){
      document.getElementById('checkout-modal').style.display="none";
    }

    function confirmOrder(){
      const name=document.getElementById('order-name').value;
      const address=document.getElementById('order-address').value;
      if(!name || !address) return alert("Введите имя и адрес!");
      const total=document.getElementById('cart-total').innerText;
      const newOrder={
        date:new Date().toLocaleString(),
        name, address,
        total,
        items:[...cart]
      };
      orders.push(newOrder);
      cart=[];
      saveData();
      closeModal();
      alert("Заказ оформлен!");
    }

    saveData();
  </script>
</body>
</html>
