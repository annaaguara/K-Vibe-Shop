<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>K-Vibe Shop</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  body {margin:0;font-family:'Poppins',sans-serif;background:#f5f5f5;color:#222;}
  .topbar{display:flex;justify-content:space-between;align-items:center;padding:10px 15px;background:linear-gradient(135deg,#ff4d6d,#ff9a9e);color:#fff;position:fixed;width:100%;top:0;z-index:1000;flex-wrap:wrap;}
  .topbar h1{margin:0;font-size:clamp(18px,5vw,28px);}
  .top-right{display:flex;align-items:center;gap:10px;position:relative;flex-wrap:wrap;}
  .top-right button{background:rgba(255,255,255,0.2);border:none;color:#fff;padding:6px 12px;border-radius:8px;cursor:pointer;white-space:nowrap;}
  .cart-count{background:#fff;color:#ff4d6d;font-weight:bold;padding:2px 6px;border-radius:50%;font-size:12px;position:absolute;top:-5px;right:-5px;}
  .container{display:flex;flex-wrap:wrap;max-width:1200px;margin:80px auto 20px;padding:0 15px;gap:15px;}
  .left{flex:1 1 220px;background:#fff;padding:15px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
  .right{flex:3 1 600px;}
  h2{color:#ff4d6d;margin:10px 0;}
  .categories,.products{display:grid;grid-template-columns:1fr;gap:10px}
  .category,.product{background:#fff;padding:10px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.1);text-align:center;cursor:pointer;position:relative;transition:0.2s;touch-action: manipulation;}
  .category:hover,.product:hover{transform:scale(1.03);}
  .category img,.product img{width:60px;height:60px;margin-bottom:5px;object-fit:contain;}
  button.add-to-cart{background:#ff4d6d;color:#fff;border:none;padding:6px 10px;border-radius:8px;cursor:pointer;transition:0.2s;}
  button.add-to-cart:hover{background:#ff2e55;}
  .delete-btn{position:absolute;top:5px;right:5px;background:#ff2e55;color:#fff;border:none;padding:2px 5px;border-radius:5px;font-size:12px;cursor:pointer;transition:0.2s;}
  .delete-btn:hover{background:#ff1a3d;}
  .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:2000;overflow:auto;-webkit-overflow-scrolling:touch;}
  .modal-content{background:#fff;margin:10% auto;padding:20px;border-radius:12px;width:95%;max-width:400px;position:relative;overflow-y:auto;max-height:80vh;}
  .close{position:absolute;top:10px;right:15px;font-size:25px;font-weight:bold;color:#aaa;cursor:pointer;}
  .close:hover{color:#000;}
  input,select{width:100%;padding:8px;margin:5px 0;border-radius:8px;border:1px solid #ccc;box-sizing:border-box;}
  .icon-select{display:grid;grid-template-columns:repeat(4,1fr);gap:5px;margin:5px 0;}
  .icon-select img{width:60px;height:60px;cursor:pointer;border:2px solid transparent;border-radius:8px;transition:0.2s;object-fit:contain;}
  .icon-select img.selected{border-color:#ff4d6d;transform:scale(1.08);}
  .admin-row{display:flex;gap:8px;align-items:center;}
  .admin-row input{flex:1;}
  .product-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;}
  .category-list-item{display:flex;align-items:center;gap:8px;padding:6px;background:#fafafa;border-radius:8px;margin-bottom:6px;}
  .small-ic{width:28px;height:28px;object-fit:contain;}
  @media(max-width:800px){.container{flex-direction:column;}.categories,.products{grid-template-columns:1fr 1fr;}}
  @media(max-width:500px){.categories,.products{grid-template-columns:1fr;}.icon-select{grid-template-columns:repeat(3,1fr);}.topbar{flex-direction:column;align-items:flex-start;gap:5px;}}
</style>
</head>
<body>

<div class="topbar">
  <h1>K-Vibe Shop</h1>
  <div class="top-right">
    <button id="cart-btn">–ö–æ—Ä–∑–∏–Ω–∞ üõí <span class="cart-count" id="cart-count">0</span></button>
    <div id="user-buttons">
      <!-- will be populated by JS -->
    </div>
    <button id="admin-btn" style="display:none;margin-left:8px;">–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</button>
  </div>
</div>

<div class="container">
  <div class="left">
    <h2>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
    <div id="categories" class="categories"></div>
  </div>

  <div class="right">
    <h2>–¢–æ–≤–∞—Ä—ã</h2>
    <div id="products-list" class="products product-grid"></div>
  </div>
</div>

<!-- Cart Modal -->
<div id="cart-modal" class="modal" aria-hidden="true">
  <div class="modal-content" role="dialog" aria-modal="true">
    <span class="close" id="close-cart">&times;</span>
    <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
    <div id="cart-items">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
    <div id="cart-total" style="margin-top:10px;font-weight:bold;"></div>
    <div style="margin-top:10px;display:flex;gap:8px;">
      <button id="checkout-btn" style="flex:1;background:#ff4d6d;color:#fff;border:none;padding:8px;border-radius:8px;cursor:pointer;">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
      <button id="clear-cart-btn" style="background:#eee;border:none;padding:8px;border-radius:8px;cursor:pointer;">–û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>
  </div>
</div>

<!-- Login Modal -->
<div id="login-modal" class="modal" aria-hidden="true">
  <div class="modal-content" role="dialog" aria-modal="true">
    <span class="close" id="close-login">&times;</span>
    <h2>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
    <input id="reg-email" type="email" placeholder="Email">
    <input id="reg-pass" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
    <div style="display:flex;gap:8px;margin-top:8px;">
      <button id="register-btn" style="flex:1;background:#ff4d6d;color:#fff;border:none;padding:8px;border-radius:8px;cursor:pointer;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
      <button id="login-submit-btn" style="flex:1;background:#eee;border:none;padding:8px;border-radius:8px;cursor:pointer;">–í–æ–π—Ç–∏</button>
    </div>
    <p id="user-status" style="margin-top:12px;">–í—ã –Ω–µ –≤–æ—à–ª–∏</p>
    <div id="logout-row" style="display:none;margin-top:8px;">
      <button id="logout-btn" style="background:#ddd;border:none;padding:8px;border-radius:8px;cursor:pointer;">–í—ã–π—Ç–∏</button>
    </div>
  </div>
</div>

<!-- Admin Modal -->
<div id="admin-modal" class="modal" aria-hidden="true">
  <div class="modal-content" role="dialog" aria-modal="true">
    <span class="close" id="close-admin">&times;</span>
    <h2>–ê–¥–º–∏–Ω–∫–∞</h2>

    <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
    <div id="admin-categories"></div>
    <div style="margin-top:8px;">
      <input id="new-cat-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏">
      <div class="icon-select" id="new-cat-icons"></div>
      <button id="add-cat-btn" style="margin-top:6px;background:#ff4d6d;color:#fff;border:none;padding:8px;border-radius:8px;cursor:pointer;">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
    </div>

    <h3 style="margin-top:16px;">–¢–æ–≤–∞—Ä—ã</h3>
    <div id="admin-products"></div>
    <div class="admin-row" style="margin-top:8px;">
      <input id="new-prod-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
      <input id="new-prod-price" placeholder="–¶–µ–Ω–∞" type="number" style="max-width:120px;">
    </div>
    <input id="new-prod-desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
    <select id="new-prod-cat"></select>
    <div class="icon-select" id="new-prod-icons"></div>
    <button id="add-prod-btn" style="margin-top:6px;background:#ff4d6d;color:#fff;border:none;padding:8px;border-radius:8px;cursor:pointer;">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>

  </div>
</div>

<script>
/* ========== –î–∞–Ω–Ω—ã–µ –∏ –∏–∫–æ–Ω–∫–∏ ========== */
const adminEmail = "annaaguara@gmail.com";

let users = JSON.parse(localStorage.getItem('users') || '{}'); // {email: {pass: '...'}}
let currentUser = localStorage.getItem('currentUser') || null;
let categories = JSON.parse(localStorage.getItem('categories') || '[]');
let products = JSON.parse(localStorage.getItem('products') || '[]');
let cart = JSON.parse(localStorage.getItem('cart') || '[]');

const iconOptions = [
  "https://cdn-icons-png.flaticon.com/512/892/892458.png","https://cdn-icons-png.flaticon.com/512/892/892462.png",
  "https://cdn-icons-png.flaticon.com/512/892/892461.png","https://cdn-icons-png.flaticon.com/512/892/892460.png",
  "https://cdn-icons-png.flaticon.com/512/892/892459.png","https://cdn-icons-png.flaticon.com/512/892/892463.png",
  "https://cdn-icons-png.flaticon.com/512/892/892464.png","https://cdn-icons-png.flaticon.com/512/892/892465.png",
  "https://cdn-icons-png.flaticon.com/512/892/892466.png","https://cdn-icons-png.flaticon.com/512/892/892467.png",
  "https://cdn-icons-png.flaticon.com/512/892/892468.png","https://cdn-icons-png.flaticon.com/512/892/892469.png",
  "https://cdn-icons-png.flaticon.com/512/892/892470.png","https://cdn-icons-png.flaticon.com/512/892/892471.png",
  "https://cdn-icons-png.flaticon.com/512/892/892472.png","https://cdn-icons-png.flaticon.com/512/892/892473.png",
  "https://cdn-icons-png.flaticon.com/512/892/892474.png","https://cdn-icons-png.flaticon.com/512/892/892475.png",
  "https://cdn-icons-png.flaticon.com/512/892/892476.png","https://cdn-icons-png.flaticon.com/512/892/892477.png",
  "https://cdn-icons-png.flaticon.com/512/892/892478.png","https://cdn-icons-png.flaticon.com/512/892/892479.png",
  "https://cdn-icons-png.flaticon.com/512/892/892480.png","https://cdn-icons-png.flaticon.com/512/892/892481.png",
  "https://cdn-icons-png.flaticon.com/512/892/892482.png","https://cdn-icons-png.flaticon.com/512/892/892483.png",
  "https://cdn-icons-png.flaticon.com/512/892/892484.png","https://cdn-icons-png.flaticon.com/512/892/892485.png",
  "https://cdn-icons-png.flaticon.com/512/892/892486.png","https://cdn-icons-png.flaticon.com/512/892/892487.png",
  "https://cdn-icons-png.flaticon.com/512/892/892488.png","https://cdn-icons-png.flaticon.com/512/892/892489.png",
  "https://cdn-icons-png.flaticon.com/512/892/892490.png","https://cdn-icons-png.flaticon.com/512/892/892491.png",
  "https://cdn-icons-png.flaticon.com/512/892/892492.png","https://cdn-icons-png.flaticon.com/512/892/892493.png",
  "https://cdn-icons-png.flaticon.com/512/892/892494.png","https://cdn-icons-png.flaticon.com/512/892/892495.png"
];

/* ========== –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –ø—É—Å—Ç–æ ========== */
if (categories.length === 0) {
  categories = [
    {name:"–°—É–º–∫–∏", icon: iconOptions[0]},
    {name:"–§—É—Ç–±–æ–ª–∫–∏", icon: iconOptions[1]},
    {name:"–ö–µ–ø–∫–∏", icon: iconOptions[2]},
    {name:"–®—Ç–∞–Ω—ã", icon: iconOptions[3]},
    {name:"–ö–æ—Å–º–µ—Ç–∏–∫–∞", icon: iconOptions[4]}
  ];
  localStorage.setItem('categories', JSON.stringify(categories));
}
if (products.length === 0) {
  products = [
    {name:"–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å—É–º–∫–∞", price:1500, desc:"–°—Ç–∏–ª—å–Ω–∞—è —Å—É–º–∫–∞", category:"–°—É–º–∫–∏", icon:iconOptions[0]},
    {name:"–§—É—Ç–±–æ–ª–∫–∞ K-Pop", price:800, desc:"–ú–æ–¥–Ω–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞", category:"–§—É—Ç–±–æ–ª–∫–∏", icon:iconOptions[1]}
  ];
  localStorage.setItem('products', JSON.stringify(products));
}

/* ========== Render-—Ñ—É–Ω–∫—Ü–∏–∏ ========== */
function renderCategories() {
  const container = document.getElementById('categories');
  container.innerHTML = '';
  // –î–æ–±–∞–≤–ª—è–µ–º "–í—Å–µ" –≤ –Ω–∞—á–∞–ª–æ
  const allDiv = document.createElement('div'); allDiv.className = 'category';
  const allImg = document.createElement('img'); allImg.src = iconOptions[5]; allImg.alt = 'all';
  allDiv.appendChild(allImg);
  const allName = document.createElement('h3'); allName.innerText = '–í—Å–µ';
  allDiv.appendChild(allName);
  allDiv.onclick = () => renderProducts(null);
  container.appendChild(allDiv);
  categories.forEach(cat => {
    const div = document.createElement('div'); div.className = 'category';
    const img = document.createElement('img'); img.src = cat.icon; img.alt = cat.name;
    const name = document.createElement('h3'); name.innerText = cat.name;
    div.appendChild(img); div.appendChild(name);
    div.onclick = () => renderProducts(cat.name);
    container.appendChild(div);
  });
}

function renderProducts(filter = null) {
  const container = document.getElementById('products-list'); container.innerHTML = '';
  let shown = 0;
  products.forEach((p, idx) => {
    if (filter && p.category !== filter) return;
    shown++;
    const div = document.createElement('div'); div.className = 'product';
    const img = document.createElement('img'); img.src = p.icon; img.alt = p.name;
    const name = document.createElement('h3'); name.innerText = p.name;
    const desc = document.createElement('p'); desc.innerText = p.desc || ''; desc.style.fontSize='13px'; desc.style.margin='6px 0';
    const price = document.createElement('p'); price.innerText = p.price + " ‚ÇΩ";
    const btn = document.createElement('button'); btn.className = 'add-to-cart'; btn.innerText = '–í –∫–æ—Ä–∑–∏–Ω—É';
    btn.onclick = (e) => { e.stopPropagation(); addToCart(idx); };
    if (currentUser === adminEmail) {
      const del = document.createElement('button'); del.className='delete-btn'; del.innerText='x';
      del.onclick = (ev) => { ev.stopPropagation(); if (confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) { products.splice(idx,1); saveProducts(); } };
      div.appendChild(del);
    }
    div.appendChild(img); div.appendChild(name); div.appendChild(desc); div.appendChild(price); div.appendChild(btn);
    container.appendChild(div);
  });
  if (shown === 0) {
    container.innerHTML = '<p style="grid-column:1/-1;color:#777">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>';
  }
}

/* ========== –ö–æ—Ä–∑–∏–Ω–∞ ========== */
function saveCart(){
  localStorage.setItem('cart', JSON.stringify(cart));
  renderCart();
}
function renderCart(){
  const cartDiv = document.getElementById('cart-items'); const totalDiv = document.getElementById('cart-total');
  cartDiv.innerHTML = '';
  if (cart.length === 0) { cartDiv.innerText = "–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞"; totalDiv.innerText = ""; document.getElementById('cart-count').innerText = 0; return; }
  let total = 0;
  cart.forEach((item, i) => {
    const row = document.createElement('div'); row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center'; row.style.padding='6px 0';
    const left = document.createElement('div'); left.innerText = `${item.name} - ${item.price} ‚ÇΩ`;
    const right = document.createElement('div');
    const rem = document.createElement('button'); rem.className='delete-btn'; rem.innerText='x'; rem.style.position='static'; rem.style.marginLeft='8px';
    rem.onclick = () => { cart.splice(i,1); saveCart(); };
    right.appendChild(rem);
    row.appendChild(left); row.appendChild(right);
    cartDiv.appendChild(row);
    total += Number(item.price);
  });
  totalDiv.innerText = "–ò—Ç–æ–≥–æ: " + total + " ‚ÇΩ";
  document.getElementById('cart-count').innerText = cart.length;
}
function addToCart(productIndex) {
  const p = products[productIndex];
  cart.push({name:p.name, price:p.price, id:Date.now(), icon:p.icon});
  saveCart();
}

/* ========== –ê–¥–º–∏–Ω–∫–∞ ========== */
function saveCategories(){ localStorage.setItem('categories', JSON.stringify(categories)); renderCategories(); renderAdminCategories(); }
function saveProducts(){ localStorage.setItem('products', JSON.stringify(products)); renderProducts(); renderAdminProducts(); }

function renderAdminCategories() {
  const container = document.getElementById('admin-categories'); container.innerHTML = '';
  categories.forEach((cat, i) => {
    const row = document.createElement('div'); row.className='category-list-item';
    const img = document.createElement('img'); img.src = cat.icon; img.className='small-ic';
    const name = document.createElement('div'); name.innerText = cat.name;
    const btn = document.createElement('button'); btn.className='delete-btn'; btn.innerText='x';
    btn.onclick = () => {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –≤ –Ω–µ–π?')) return;
      const catName = categories[i].name;
      categories.splice(i,1);
      products = products.filter(p => p.category !== catName);
      saveCategories(); saveProducts();
    };
    row.appendChild(img); row.appendChild(name); row.appendChild(btn);
    container.appendChild(row);
  });
  // fill select for product category
  const select = document.getElementById('new-prod-cat'); select.innerHTML = '';
  categories.forEach(cat => {
    const opt = document.createElement('option'); opt.value = cat.name; opt.innerText = cat.name; select.appendChild(opt);
  });
}

function renderAdminProducts() {
  const container = document.getElementById('admin-products'); container.innerHTML = '';
  products.forEach((p, i) => {
    const row = document.createElement('div'); row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center'; row.style.padding='6px 0';
    const left = document.createElement('div'); left.innerText = `${p.name} ‚Äî ${p.category} ‚Äî ${p.price} ‚ÇΩ`;
    const right = document.createElement('div');
    const del = document.createElement('button'); del.className='delete-btn'; del.innerText='x';
    del.onclick = () => { if (confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) { products.splice(i,1); saveProducts(); } };
    right.appendChild(del);
    row.appendChild(left); row.appendChild(right);
    container.appendChild(row);
  });
}

/* –ò–∫–æ–Ω–∫–∏ –≤ –∞–¥–º–∏–Ω–∫–µ - –≤—ã–±–æ—Ä */
function fillIconSelector(containerId) {
  const container = document.getElementById(containerId); container.innerHTML = '';
  iconOptions.forEach((url, idx) => {
    const img = document.createElement('img'); img.src = url; img.alt = 'icon-'+idx;
    img.dataset.url = url;
    img.onclick = () => {
      container.querySelectorAll('img').forEach(i => i.classList.remove('selected'));
      img.classList.add('selected');
    };
    container.appendChild(img);
  });
}

/* ========== –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: UI –∏ auth ========== */
function showUserUI(){
  const ub = document.getElementById('user-buttons');
  const status = document.getElementById('user-status');
  const logoutRow = document.getElementById('logout-row');

  if (currentUser) {
    ub.innerHTML = `<button id="user-btn">${currentUser}</button>`;
    status.innerText = '–í–æ—à–ª–∏ –∫–∞–∫: ' + currentUser;
    logoutRow.style.display = 'block';
  } else {
    ub.innerHTML = `<button id="login-btn">–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>`;
    const loginBtn = document.getElementById('login-btn');
    if (loginBtn) loginBtn.onclick = () => openModal('login-modal');
    status.innerText = '–í—ã –Ω–µ –≤–æ—à–ª–∏';
    logoutRow.style.display = 'none';
  }
  document.getElementById('admin-btn').style.display = (currentUser === adminEmail) ? 'inline-block' : 'none';
}
function logout(){
  currentUser = null;
  localStorage.removeItem('currentUser');
  showUserUI();
  closeModal('login-modal');
}

/* ========== –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω–∫–∏ ========== */
function addCategoryFromAdmin(){
  const name = document.getElementById('new-cat-name').value.trim();
  if (!name) { alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'); return; }
  const sel = document.getElementById('new-cat-icons').querySelector('img.selected');
  const icon = sel ? sel.dataset.url : iconOptions[0];
  categories.push({name, icon});
  document.getElementById('new-cat-name').value = '';
  document.getElementById('new-cat-icons').querySelectorAll('img').forEach(i=>i.classList.remove('selected'));
  saveCategories();
}

function addProductFromAdmin(){
  const name = document.getElementById('new-prod-name').value.trim();
  const price = parseFloat(document.getElementById('new-prod-price').value);
  const desc = document.getElementById('new-prod-desc').value.trim();
  const cat = document.getElementById('new-prod-cat').value;
  if (!name || isNaN(price) || !cat) { alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è, —Ü–µ–Ω—É –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é'); return; }
  const sel = document.getElementById('new-prod-icons').querySelector('img.selected');
  const icon = sel ? sel.dataset.url : iconOptions[0];
  products.push({name, price, desc, category: cat, icon});
  document.getElementById('new-prod-name').value = ''; document.getElementById('new-prod-price').value = ''; document.getElementById('new-prod-desc').value = '';
  document.getElementById('new-prod-icons').querySelectorAll('img').forEach(i=>i.classList.remove('selected'));
  saveProducts();
}

/* ========== Events bind & init ========== */
function openModal(id){ const el = document.getElementById(id); if (el) { el.style.display='block'; el.setAttribute('aria-hidden','false'); } }
function closeModal(id){ const el = document.getElementById(id); if (el) { el.style.display='none'; el.setAttribute('aria-hidden','true'); } }

function init(){
  // bind modal close buttons
  document.getElementById('cart-btn').onclick = () => { renderCart(); openModal('cart-modal'); };
  document.getElementById('close-cart').onclick = () => closeModal('cart-modal');
  document.getElementById('close-login').onclick = () => closeModal('login-modal');
  document.getElementById('close-admin').onclick = () => closeModal('admin-modal');

  // cart controls
  document.getElementById('checkout-btn').onclick = () => {
    if (cart.length === 0) { alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!'); return; }
    alert('–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞: ' + cart.map(i => i.name).join(', '));
    cart = []; saveCart(); closeModal('cart-modal');
  };
  document.getElementById('clear-cart-btn').onclick = () => { if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É?')) { cart = []; saveCart(); } };

  // auth buttons
  document.getElementById('register-btn').onclick = () => {
    const email = document.getElementById('reg-email').value.trim();
    const pass = document.getElementById('reg-pass').value;
    if (!email || !pass) { alert('–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å'); return; }
    if (users[email]) { alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω. –í–æ–π–¥–∏—Ç–µ.'); return; }
    users[email] = {pass: pass};
    localStorage.setItem('users', JSON.stringify(users));
    alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞. –ú–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏.');
  };
  document.getElementById('login-submit-btn').onclick = () => {
    const email = document.getElementById('reg-email').value.trim();
    const pass = document.getElementById('reg-pass').value;
    if (!email || !pass) { alert('–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å'); return; }
    if (!users[email] || users[email].pass !== pass) { alert('–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å'); return; }
    currentUser = email;
    localStorage.setItem('currentUser', currentUser);
    showUserUI();
    closeModal('login-modal');
  };
  document.getElementById('logout-btn').onclick = logout;

  // admin controls
  document.getElementById('admin-btn').onclick = () => openModal('admin-modal');
  document.getElementById('add-cat-btn').onclick = addCategoryFromAdmin;
  document.getElementById('add-prod-btn').onclick = addProductFromAdmin;

  // click outside modal to close
  window.onclick = function(e){
    ['login-modal','cart-modal','admin-modal'].forEach(id => {
      const el = document.getElementById(id);
      if (el && e.target === el) closeModal(id);
    });
  };
  window.addEventListener('keydown', (e) => { if (e.key === 'Escape') { ['login-modal','cart-modal','admin-modal'].forEach(closeModal); } });

  // fill icon pickers
  fillIconSelector('new-cat-icons');
  fillIconSelector('new-prod-icons');

  // initial render
  showUserUI();
  renderCategories();
  renderProducts();
  renderCart();
  renderAdminCategories();
  renderAdminProducts();
}

document.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>
