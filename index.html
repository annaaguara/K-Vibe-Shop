<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>K-Vibe Shop ‚Äî –ö–æ—Ä–µ–π—Å–∫–∞—è –º–æ–¥–∞</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body {font-family:'Poppins',sans-serif;margin:0;background:#f5f5f5;color:#222;}
*{box-sizing:border-box;}
.topbar{position:fixed;top:0;left:0;width:100%;background:linear-gradient(135deg,#ff4d6d,#ff9a9e);color:#fff;display:flex;justify-content:space-between;align-items:center;padding:10px 20px;z-index:1000;box-shadow:0 2px 8px rgba(0,0,0,0.15);}
.topbar h1{margin:0;font-size:clamp(18px,5vw,28px);font-weight:700;}
.top-right{display:flex;align-items:center;gap:15px;position:relative;}
.top-right button{background:rgba(255,255,255,0.2);border:none;color:#fff;padding:6px 12px;border-radius:8px;cursor:pointer;transition:0.3s;}
.top-right button:hover{background:rgba(255,255,255,0.35);}
.cart-count{background:#fff;color:#ff4d6d;font-weight:bold;padding:2px 6px;border-radius:50%;font-size:12px;position:absolute;top:-5px;right:-5px;transition:all 0.3s;}
.container{display:flex;max-width:1200px;margin:80px auto 20px auto;padding:0 20px;gap:20px;}
.left{flex:1 1 220px;background:#fff;padding:15px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
.right{flex:3 1 600px;}
h2{color:#ff4d6d;margin:15px 0 10px 0;}
.categories,.products{display:grid;grid-template-columns:1fr;gap:15px;}
.category,.product{background:#fff;padding:15px;border-radius:12px;box-shadow:0 3px 6px rgba(0,0,0,0.1);text-align:center;cursor:pointer;transition:all 0.3s;position:relative;}
.category:hover,.product:hover{transform:scale(1.05);box-shadow:0 6px 12px rgba(0,0,0,0.15);}
.category img,.product img{width:50px;height:50px;margin-bottom:10px;}
button.add-to-cart{background:#ff4d6d;color:#fff;border:none;padding:10px 16px;border-radius:10px;cursor:pointer;margin-top:5px;transition:all 0.3s;}
button.add-to-cart:hover{background:#ff2e55;transform:scale(1.05);}
.modal{display:none;position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,0.5);padding-top:60px;}
.modal-content{background-color:#fff;margin:5% auto;padding:20px;border-radius:12px;width:90%;max-width:500px;position:relative;transition:all 0.3s;}
.close{color:#aaa;float:right;font-size:28px;font-weight:bold;cursor:pointer;position:absolute;top:10px;right:20px;}
.close:hover{color:#000;}
input,select{width:95%;padding:10px;margin:5px 0;border-radius:10px;border:1px solid #ccc;}
button{margin-top:5px;cursor:pointer;}
.delete-btn{position:absolute;top:5px;right:5px;background:#ff2e55;color:#fff;padding:3px 6px;border:none;border-radius:5px;font-size:12px;cursor:pointer;}
.delete-btn:hover{background:#ff1a3d;}
.products .product{opacity:1;transform:translateY(0);transition:all 0.3s;}
.products .product.hide{opacity:0;transform:translateY(20px);pointer-events:none;}
@media(max-width:800px){.container{flex-direction:column;}.left,.right{width:100%;}.categories,.products{grid-template-columns:1fr 1fr;}}
@media(max-width:500px){.categories,.products{grid-template-columns:1fr;}}
.icon-select img{width:50px;height:50px;margin:5px;cursor:pointer;border:2px solid transparent;border-radius:8px;transition:all 0.2s;}
.icon-select img.selected{border-color:#ff4d6d;transform:scale(1.1);}
</style>
</head>
<body>
<div class="topbar">
<h1>K-Vibe Shop</h1>
<div class="top-right">
  <div style="position:relative;">
    <button id="cart-btn">–ö–æ—Ä–∑–∏–Ω–∞ üõí</button>
    <span class="cart-count" id="cart-count">0</span>
  </div>
  <div id="user-buttons">
    <button id="login-btn">–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
  </div>
</div>
</div>

<div class="container">
  <div class="left">
    <h2>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
    <div id="categories" class="categories"></div>
    <button id="admin-btn" style="display:none;">–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</button>
  </div>
  <div class="right">
    <h2>–¢–æ–≤–∞—Ä—ã</h2>
    <div id="products-list" class="products"></div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∏ -->
<div id="cart-modal" class="modal">
  <div class="modal-content">
    <span class="close" id="close-cart">&times;</span>
    <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
    <div id="cart-items">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
    <div class="cart-total" id="cart-total"></div>
    <button onclick="checkout()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>
</div>

<div id="login-modal" class="modal">
  <div class="modal-content">
    <span class="close" id="close-login">&times;</span>
    <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è / –í—Ö–æ–¥</h2>
    <input id="reg-email" type="email" placeholder="Email">
    <input id="reg-pass" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
    <button id="register-btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    <button id="login-submit-btn">–í–æ–π—Ç–∏</button>
    <p id="user-status">–í—ã –Ω–µ –≤–æ—à–ª–∏</p>
  </div>
</div>

<div id="admin-modal" class="modal">
  <div class="modal-content">
    <span class="close" id="close-admin">&times;</span>
    <h2>–ê–¥–º–∏–Ω–∫–∞</h2>

    <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
    <div id="admin-categories"></div>
    <input id="new-cat-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏">
    <div class="icon-select" id="new-cat-icons"></div>
    <button onclick="addCategory()">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>

    <h3>–¢–æ–≤–∞—Ä—ã</h3>
    <div id="admin-products"></div>
    <input id="new-prod-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
    <input id="new-prod-price" placeholder="–¶–µ–Ω–∞">
    <input id="new-prod-desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
    <select id="new-prod-cat"></select>
    <div class="icon-select" id="new-prod-icons"></div>
    <button onclick="addProduct()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
  </div>
</div>

<script>
// ===== –î–∞–Ω–Ω—ã–µ =====
const adminEmail="annaaguara@gmail.com";
let users=JSON.parse(localStorage.getItem('users')||'{}');
let currentUser=localStorage.getItem('currentUser')||null;
let categories=JSON.parse(localStorage.getItem('categories')||'[]');
let products=JSON.parse(localStorage.getItem('products')||'[]');
let cart=JSON.parse(localStorage.getItem('cart')||'[]');

// ===== –ò–∫–æ–Ω–∫–∏ (URL –∫–∞—Ä—Ç–∏–Ω–æ–∫) =====
const iconOptions=[
  "https://i.postimg.cc/2yB1T6pG/bag.png",
  "https://i.postimg.cc/NF3yH0Xk/shirt.png",
  "https://i.postimg.cc/3x3vR9tc/hat.png",
  "https://i.postimg.cc/Y9sy2M2f/pants.png"
];

// ===== –ú–æ–¥–∞–ª–∫–∏ =====
function openModal(id){document.getElementById(id).style.display='block';}
function closeModal(id){document.getElementById(id).style.display='none';}
document.getElementById('login-btn').onclick=()=>openModal('login-modal');
document.getElementById('cart-btn').onclick=()=>openModal('cart-modal');
document.getElementById('admin-btn').onclick=()=>openModal('admin-modal');
document.getElementById('close-login').onclick=()=>closeModal('login-modal');
document.getElementById('close-cart').onclick=()=>closeModal('cart-modal');
document.getElementById('close-admin').onclick=()=>closeModal('admin-modal');
window.onclick=function(e){['login-modal','cart-modal','admin-modal'].forEach(id=>{if(e.target==document.getElementById(id)) closeModal(id);});}

// ===== –°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è =====
function updateStatus(){
  const status=document.getElementById('user-status');
  const userButtons=document.getElementById('user-buttons');
  const adminBtn=document.getElementById('admin-btn');
  if(currentUser){
    status.innerHTML=`–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: <b>${currentUser}</b>`;
    userButtons.innerHTML=`<span style="color:#fff;">${currentUser}</span> <button onclick="logout()">–í—ã–π—Ç–∏</button>`;
    adminBtn.style.display=(currentUser===adminEmail)?'block':'none';
  } else {
    status.innerText="–í—ã –Ω–µ –≤–æ—à–ª–∏";
    userButtons.innerHTML=`<button onclick="openModal('login-modal')">–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>`;
    adminBtn.style.display='none';
  }
}
updateStatus();

// ===== –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–õ–æ–≥–∏–Ω =====
document.getElementById('register-btn').onclick=function(){
  const email=document.getElementById('reg-email').value.trim();
  const pass=document.getElementById('reg-pass').value.trim();
  if(!email||!pass){alert("–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å");return;}
  if(users[email]){alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç");return;}
  users[email]={password:pass};
  localStorage.setItem('users',JSON.stringify(users));
  loginUser(email);
};
document.getElementById('login-submit-btn').onclick=function(){
  const email=document.getElementById('reg-email').value.trim();
  const pass=document.getElementById('reg-pass').value.trim();
  if(users[email]&&users[email].password===pass) loginUser(email);
  else alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å");
};
function loginUser(email){currentUser=email;localStorage.setItem('currentUser',currentUser);updateStatus();closeModal('login-modal');}
function logout(){currentUser=null;localStorage.removeItem('currentUser');updateStatus();}

// ===== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π/—Ç–æ–≤–∞—Ä–æ–≤ =====
if(categories.length===0){
  categories=[
    {name:"–°—É–º–∫–∏",icon:iconOptions[0]},
    {name:"–§—É—Ç–±–æ–ª–∫–∏",icon:iconOptions[1]},
    {name:"–ö–µ–ø–∫–∏",icon:iconOptions[2]},
    {name:"–®—Ç–∞–Ω—ã",icon:iconOptions[3]}
  ];
}
if(products.length===0){
  products=[
    {name:"–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å—É–º–∫–∞",price:1500,desc:"–°—Ç–∏–ª—å–Ω–∞—è —Å—É–º–∫–∞",category:"–°—É–º–∫–∏",icon:iconOptions[0]},
    {name:"–§—É—Ç–±–æ–ª–∫–∞ K-Pop",price:800,desc:"–ú–æ–¥–Ω–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞",category:"–§—É—Ç–±–æ–ª–∫–∏",icon:iconOptions[1]}
  ];
}

// ===== –†–µ–Ω–¥–µ—Ä =====
function renderCategories(){
  const container=document.getElementById('categories');
  container.innerHTML='';
  categories.forEach((cat,index)=>{
    const div=document.createElement('div'); div.className='category';
    const img=document.createElement('img'); img.src=cat.icon; div.appendChild(img);
    const name=document.createElement('h3'); name.innerText=cat.name; div.appendChild(name);
    div.onclick=()=>filterProducts(cat.name);
    container.appendChild(div);
  });
}

function renderProducts(filter=null){
  const container=document.getElementById('products-list'); container.innerHTML='';
  products.forEach((p,index)=>{
    if(filter && p.category!==filter) return;
    const div=document.createElement('div'); div.className='product hide';
    const img=document.createElement('img'); img.src=p.icon; div.appendChild(img);
    const name=document.createElement('h3'); name.innerText=p.name; div.appendChild(name);
    const price=document.createElement('p'); price.innerText=p.price+" ‚ÇΩ"; div.appendChild(price);
    const btn=document.createElement('button'); btn.className='add-to-cart'; btn.innerText='–í –∫–æ—Ä–∑–∏–Ω—É';
    btn.onclick=()=>{cart.push(p);localStorage.setItem('cart',JSON.stringify(cart));renderCart();};
    div.appendChild(btn);
    container.appendChild(div);
    setTimeout(()=>div.classList.remove('hide'),50);
  });
}

function filterProducts(catName){renderProducts(catName);}

// ===== –ö–æ—Ä–∑–∏–Ω–∞ =====
function renderCart(){
  const cartDiv=document.getElementById('cart-items');
  const totalDiv=document.getElementById('cart-total');
  cartDiv.innerHTML='';
  if(cart.length===0){cartDiv.innerText="–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞";totalDiv.innerText="";document.getElementById('cart-count').innerText=0;return;}
  let total=0;
  cart.forEach(item=>{
    const div=document.createElement('div'); div.className='cart-item';
    div.innerText=item.name+" - "+item.price+" ‚ÇΩ";
    cartDiv.appendChild(div);
    total+=item.price;
  });
  totalDiv.innerText="–ò—Ç–æ–≥–æ: "+total+" ‚ÇΩ";
  document.getElementById('cart-count').innerText=cart.length;
}

function checkout(){
  if(cart.length===0){alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!");return;}
  alert("–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞: "+cart.map(i=>i.name).join(", "));
  cart=[]; localStorage.setItem('cart',JSON.stringify(cart)); renderCart(); closeModal('cart-modal');
}

// ===== –ê–¥–º–∏–Ω–∫–∞ =====
function renderAdminCategories(){
  const container=document.getElementById('admin-categories'); container.innerHTML='';
  categories.forEach((c,i)=>{
    const div=document.createElement('div'); div.innerText=c.name;
    const btn=document.createElement('button'); btn.innerText='–£–¥–∞–ª–∏—Ç—å'; btn.className='delete-btn';
    btn.onclick=()=>{if(confirm("–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é?")){categories.splice(i,1); products=products.filter(p=>p.category!==c.name); saveData();}};
    div.appendChild(btn);
    container.appendChild(div);
  });
}

function renderAdminProducts(){
  const container=document.getElementById('admin-products'); container.innerHTML='';
  products.forEach((p,i)=>{
    const div=document.createElement('div'); div.innerText=p.name+" - "+p.price+" ‚ÇΩ ["+p.category+"]";
    const btn=document.createElement('button'); btn.innerText='–£–¥–∞–ª–∏—Ç—å'; btn.className='delete-btn';
    btn.onclick=()=>{if(confirm("–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?")){products.splice(i,1); saveData();}};
    div.appendChild(btn);
    container.appendChild(div);
  });
}

function saveData(){ localStorage.setItem('categories',JSON.stringify(categories)); localStorage.setItem('products',JSON.stringify(products)); renderCategories(); renderProducts(); renderAdminCategories(); renderAdminProducts(); populateProdCatSelect(); }

function populateProdCatSelect(){
  const sel=document.getElementById('new-prod-cat'); sel.innerHTML='';
  categories.forEach(c=>{let opt=document.createElement('option'); opt.value=c.name; opt.innerText=c.name; sel.appendChild(opt);});
}

// ===== –í—ã–±–æ—Ä –∏–∫–æ–Ω–æ–∫ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏ =====
function setupIconSelect(containerId){
  const container=document.getElementById(containerId); container.innerHTML='';
  iconOptions.forEach(icon=>{
    const img=document.createElement('img'); img.src=icon;
    img.onclick=()=>{container.querySelectorAll('img').forEach(i=>i.classList.remove('selected')); img.classList.add('selected');};
    container.appendChild
