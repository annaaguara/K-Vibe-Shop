<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>K-Vibe Shop</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg-light: #f8f8f8;
  --bg-pink: #fce4ec;
  --text-dark: #444;
  --accent: #e91e63;
  --accent-light: #f8bbd0;
  --card-bg: #fff;
  --highlight: #ffe4f0;
}
* {margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif;}
body {display:flex; flex-direction:column; min-height:100vh; background:var(--bg-light); color:var(--text-dark);}
header {background:var(--bg-pink); padding:1rem; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
header h1 {font-size:1.5rem; font-weight:700;}
header nav button {margin-left:.5rem; padding:.5rem 1rem; border:none; border-radius:8px; background:var(--accent); color:white; cursor:pointer; transition:.3s;}
header nav button:hover {background:#c2185b;}
main {display:flex; flex:1;}
aside {width:220px; background:#f1f1f1; padding:1rem; overflow-y:auto;}
aside h2 {font-size:1.2rem; margin-bottom:.5rem;}
.category, .subcategory {cursor:pointer; padding:.3rem 0; transition:.3s; display:flex; justify-content:space-between; align-items:center; border-radius:6px;}
.category:hover, .subcategory:hover {color:var(--accent); background:var(--accent-light);}
.category.selected, .subcategory.selected {background:var(--highlight);}
.delete-btn {background:red; color:white; border:none; padding:2px 5px; border-radius:4px; cursor:pointer; margin-left:.5rem;}
section {flex:1; padding:1rem; display:grid; grid-template-columns:repeat(auto-fit, minmax(200px,1fr)); gap:1rem;}
.product {background:var(--card-bg); border-radius:12px; padding:1rem; box-shadow:0 2px 5px rgba(0,0,0,0.1); display:flex; flex-direction:column; justify-content:space-between; transition:transform .2s; position:relative;}
.product:hover {transform:scale(1.02);}
.product img {width:100%; border-radius:8px; margin-bottom:.5rem;}
.product h3 {font-size:1rem; margin:.3rem 0;}
.product p {font-size:.9rem; margin-bottom:.5rem;}
.product button {padding:.5rem; border:none; border-radius:8px; background:var(--accent); color:white; cursor:pointer; transition:.3s;}
.product button:hover {background:#c2185b;}
.product .delete-btn {position:absolute; top:5px; right:5px; background:red;}
#cartModal, #authModal, #adminModal {position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:none; align-items:center; justify-content:center;}
.modal-content {background:var(--card-bg); padding:1.5rem; border-radius:12px; width:90%; max-width:400px; max-height:80vh; overflow-y:auto;}
.modal-content h2 {margin-bottom:1rem;}
.modal-content button {margin-top:1rem;}
.cart-item {display:flex; justify-content:space-between; margin-bottom:.3rem; align-items:center;}
.cart-item button {background:red; color:white; border:none; padding:2px 5px; border-radius:4px; cursor:pointer;}
@media(max-width:768px){main{flex-direction:column;} aside{width:100%; order:1;} section{order:2;}}
</style>
</head>
<body>
<header>
  <h1>K-Vibe Shop</h1>
  <nav>
    <button onclick="openModal('authModal')">Вход / Регистрация</button>
    <button onclick="openModal('cartModal')">Корзина</button>
    <button onclick="openModal('adminModal')">Админ</button>
  </nav>
</header>

<main>
  <aside>
    <h2>Категории</h2>
    <div id="categories"></div>
  </aside>
  <section id="products"></section>
</main>

<div id="cartModal">
  <div class="modal-content">
    <h2>Корзина</h2>
    <div id="cartItems"></div>
    <p id="cartTotal"></p>
    <button onclick="closeModal('cartModal')">Закрыть</button>
  </div>
</div>

<div id="authModal">
  <div class="modal-content">
    <h2>Вход / Регистрация</h2>
    <input type="text" id="username" placeholder="Имя" style="width:100%;margin:.3rem 0;padding:.5rem;">
    <input type="password" id="password" placeholder="Пароль" style="width:100%;margin:.3rem 0;padding:.5rem;">
    <button onclick="register()">Регистрация</button>
    <button onclick="login()">Вход</button>
    <button onclick="closeModal('authModal')">Закрыть</button>
  </div>
</div>

<div id="adminModal">
  <div class="modal-content">
    <h2>Админ панель</h2>
    <h3>Добавить категорию</h3>
    <input type="text" id="newCategory" placeholder="Название категории" style="width:100%;margin:.3rem 0;padding:.5rem;">
    <button onclick="addCategory()">Добавить</button>
    <h3>Добавить товар</h3>
    <input type="text" id="productName" placeholder="Название" style="width:100%;margin:.3rem 0;padding:.5rem;">
    <input type="text" id="productPrice" placeholder="Цена" style="width:100%;margin:.3rem 0;padding:.5rem;">
    <input type="text" id="productImg" placeholder="Ссылка на фото" style="width:100%;margin:.3rem 0;padding:.5rem;">
    <input type="text" id="productCategory" placeholder="Категория" style="width:100%;margin:.3rem 0;padding:.5rem;">
    <input type="text" id="productSubcategory" placeholder="Подкатегория (необязательно)" style="width:100%;margin:.3rem 0;padding:.5rem;">
    <button onclick="addProduct()">Добавить товар</button>
    <button onclick="closeModal('adminModal')">Закрыть</button>
  </div>
</div>

<script>
let categories = JSON.parse(localStorage.getItem('categories')) || {
  "Косметика": ["Сэты", "Крема", "Солнцезащитные крема"],
  "Сумки": [],
  "Одежда": ["Худи", "Футболки"]
};
let products = JSON.parse(localStorage.getItem('products')) || [
  {name:"Крем", price:500, img:"https://via.placeholder.com/200", category:"Косметика", subcategory:"Крема"},
  {name:"Худи", price:1500, img:"https://via.placeholder.com/200", category:"Одежда", subcategory:"Худи"},
];
let cart = [];
let currentCategory = Object.keys(categories)[0] || "";
let currentSubcategory = null;

function saveData(){ 
  localStorage.setItem('categories', JSON.stringify(categories));
  localStorage.setItem('products', JSON.stringify(products));
}

function renderCategories(){
  let catDiv = document.getElementById("categories");
  catDiv.innerHTML = "";
  for(let cat in categories){
    let c = document.createElement("div");
    c.className = "category" + (currentCategory===cat && !currentSubcategory ? " selected" : "");
    c.textContent = cat;

    let delBtn = document.createElement("button");
    delBtn.className = "delete-btn";
    delBtn.textContent = "X";
    delBtn.onclick = (e)=>{
      e.stopPropagation();
      deleteCategory(cat);
    };
    c.appendChild(delBtn);

    c.onclick = ()=>{
      currentCategory=cat; currentSubcategory=null;
      renderCategories();
      renderProducts(cat);
    };
    catDiv.appendChild(c);

    categories[cat].forEach(sub=>{
      let s = document.createElement("div");
      s.className = "subcategory" + (currentSubcategory===sub ? " selected" : "");
      s.textContent = "— "+sub;
      s.style.marginLeft="1rem";

      let delSub = document.createElement("button");
      delSub.className="delete-btn";
      delSub.textContent="X";
      delSub.onclick=(e)=>{
        e.stopPropagation();
        deleteSubcategory(cat, sub);
      }
      s.appendChild(delSub);

      s.onclick = ()=>{
        currentCategory=cat; currentSubcategory=sub;
        renderCategories();
        renderProducts(cat, sub);
      };
      catDiv.appendChild(s);
    });
  }
}

function renderProducts(cat, sub=null){
  let prodDiv=document.getElementById("products");
  prodDiv.innerHTML="";
  let filtered = products.filter(p=>{
    if(sub) return p.category===cat && p.subcategory===sub;
    return p.category===cat;
  });
  if(filtered.length===0){
    prodDiv.innerHTML="<p>Товаров нет</p>";
  }
  filtered.forEach((p,i)=>{
    let card=document.createElement("div");
    card.className="product";
    card.innerHTML=`
      <img src="${p.img}" alt="${p.name}">
      <h3>${p.name}</h3>
      <p>${p.price}₩</p>
      <button onclick="addToCart('${p.name}')">В корзину</button>
    `;

    let delBtn = document.createElement("button");
    delBtn.className = "delete-btn";
    delBtn.textContent = "X";
    delBtn.onclick = ()=>{deleteProduct
